(()=>{"use strict";const e=document.querySelector(".nav-toggle"),t=document.querySelector(".links"),n=document.querySelector(".box-container"),a=(document.querySelector(".popup-container"),document.querySelector(".shown-movies")),s=(document.querySelector("#movie-close-btn"),document.querySelector("#close-reservation"),document.querySelector(".popup-section")),i=document.querySelector(".reservation-section"),o="https://us-central1-involvement-api.cloudfunctions.net/capstoneApi/apps/xK5LmH1OlvUhFH39ssaa/comments",r=(document.querySelector(".btn-comments"),document.querySelector(".add-comments"),document.querySelector("#commenter-name"),document.querySelector("#comment-text"),"https://us-central1-involvement-api.cloudfunctions.net/capstoneApi/apps/milQHnStnYxG5awlXqqf/likes/"),c=document.querySelector(".year"),d=(e,t)=>{e.forEach((e=>{const n=`<h4>${e.username} ${e.creation_date}</h4>\n                      <p>${e.comment}</p>`;t.innerHTML+=n}))},l=async e=>{const t=await fetch(`${o}?item_id=${e}`);return 400!==t.status?t.json():[]},m=async e=>await fetch(`https://us-central1-involvement-api.cloudfunctions.net/capstoneApi/apps/xK5LmH1OlvUhFH39ssaa/reservations?item_id="${e}"`).then((e=>e.json())),u=async()=>{const e=await(async e=>await fetch(`https://api.tvmaze.com/search/shows?q=${e}`).then((e=>e.json())))("s"),t=await(async()=>await fetch(`${r}`).then((e=>e.json())))(),c=new DocumentFragment,u=new DOMParser;e.forEach(((e,n)=>{const{show:a}=e,s=t.find((e=>e.item_id===a.id));let i=0;s&&(i=s.likes);const o=`\n            <div class="box" data-id=${e.show.id}>\n              <div class="box-img">\n                <img src="${a.image.original}" alt="${a.name}"/>\n              </div>\n              <div class="box-desc">\n                <h4>${a.name}</h4>\n                \n                <div class="likes" data-id="${a.id}" role="button">          \n                  <a href="#" class="like-btn"><i class="fa-regular fa-heart"></i></a>\n                 <p>${i}</p>\n                </div>    \n              </div>\n              <div class="btn-container" data-index="${n}" role="button">\n                <button class="btn btn-comments" id=${a.externals.thetvdb}>\n                  comments\n              </button>\n                <button type="button" class="btn btn-reservation" id="${e.show.externals.imdb}">Reservations</button>\n              </div>\n            </div>`,r=u.parseFromString(o,"text/html").body.firstChild;c.appendChild(r)})),n.appendChild(c);const p=(e=>{const t=document.querySelectorAll(`.${e}`);let n=0;return t.forEach((()=>{n+=1})),n})("box");a.innerText=`Shows(${p})`,document.querySelectorAll(".btn-comments").forEach((e=>{e.addEventListener("click",(async e=>{s.style.display="block";const t=e.target.id,n=await fetch(`https://api.tvmaze.com/lookup/shows?thetvdb=${t}`).then((e=>e.json())),a=`<div class="popup-container">\n      <button type="button" class="btn comments-close-btn" id="movie-close-btn">\n        <i class="fas fa-times"></i>\n      </button>\n      <div class="popup-img">\n        <img\n          src="${n.image.original}"\n          alt="${n.name}"\n        />\n      </div>\n      <div class="title-description">\n        <h3>${n.name}</h3>\n        <div class="popup-description">\n        <p>Genres: ${n.genres}</p>\n        <p>Language: ${n.language}</p>\n        <p>Premiered: ${n.premiered}</p>\n        <p>Country: ${n.network.country.name}</p>\n        </div>\n      </div>\n      <div class="popup-comments">\n        <h3>Comments(2)</h3>\n        <div class="list-of-comments">\n          \n        </div>\n      </div>\n      <form method="post" class="add-comments">\n        <h3>Add Comments</h3>\n        <div class="input-field">\n          <input\n            type="text"\n            placeholder="Your name"\n            class="input"\n            id="commenter-name"\n            required\n          />\n        </div>\n        <div class="input-field">\n          <textarea\n            id="comment-text"\n            class="input"\n            cols="30"\n            rows="5"\n            placeholder="Your comments"\n            required\n          ></textarea>\n        </div>\n        <div class="btn-container">\n          <button type="submit" class="btn" id="${e.target.id}">Submit</button>\n        </div>\n      </form>\n      </div>`;s.innerHTML=a;const i=document.querySelector(".list-of-comments");let r=await l(t);d(r,i);const c=document.querySelector(".add-comments"),m=document.querySelector("#commenter-name"),u=document.querySelector("#comment-text");c.addEventListener("submit",(async e=>{e.preventDefault(),await(async(e,t,n)=>await fetch(o,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({item_id:e,username:t,comment:n})}))(t,m.value,u.value),i.innerHTML="",r=await l(t),d(r,i),c.reset()}))}))})),document.querySelectorAll(".btn-reservation").forEach((e=>{e.addEventListener("click",(async()=>{const t=await(async e=>await fetch(`https://api.tvmaze.com/lookup/shows?imdb=${e}`).then((e=>e.json())))(e.id);i.classList.remove("hide-reservation");const n=`<div class="reservation-container">\n        <button type="button" class="btn reservation-close-btn" id="close-reservation">\n          <i class="fas fa-times"></i>\n        </button>\n        <div class="reservation-img">\n          <img\n            src="${t.image.original}"\n            alt="${t.name}"\n          />\n        </div>\n        <div class="reservation-description">\n          <h3>${t.name}</h3>\n          <div class="reservations">\n            <p>Genres: ${t.genres}</p>\n            <p>Language: ${t.language}</p>\n            <p>Premiered: ${t.premiered}</p>\n            <p>Country: ${t.network.country.name}</p>\n          </div>\n        </div>\n        <div class="popup-reservations">\n          <h3>Reservations(2)</h3>\n          <div class="list-of-reservations">\n          </div>\n        </div>\n        <form method="post" class="add-reservation">\n          <h3>Add a reservation</h3>\n          <div class="input-field">\n          <input type="text" placeholder="Your name" class="input" name="name" id="nameReservation"/>\n          </div>\n          <div class="input-field">\n          <label for="startDate">Start date:</label>\n          <input type="text" placeholder="yyyy-mm-dd" class="input" name="startDate" id="startDate"/>\n          </div>\n          <div class="input-field">\n          <label for="endDate">End date:</label>\n          <input type="text" placeholder="yyyy-mm-dd" class="input" name="endDate" id="endDate"/>\n          </div>\n          <div class="btn-container">\n            <button type="submit" class="btn" id="reserve">Reserve</button>\n            <p class="alarm-form-reservations"></p>\n          </div>\n        </form>\n      </div>`;i.innerHTML=n,document.getElementById("reserve").addEventListener("click",(async t=>{const n=document.querySelector(".alarm-form-reservations"),a=document.getElementById("nameReservation").value,s=document.getElementById("startDate").value,i=document.getElementById("endDate").value;if(a&&s&&i){n.innerHTML="";const o=/^\d{4}-\d{2}-\d{2}$/;if(s.match(o)&&i.match(o)){n.innerHTML="Reservation Completed",await(async(e,t,n,a,s)=>(e.preventDefault(),await fetch("https://us-central1-involvement-api.cloudfunctions.net/capstoneApi/apps/xK5LmH1OlvUhFH39ssaa/reservations/",{method:"POST",body:JSON.stringify({item_id:`"${t}"`,username:`"${n}"`,date_start:`"${a}"`,date_end:`"${s}"`}),headers:{"Content-type":"application/json; charset=UTF-8"}})))(t,e.id,a,s,i);const o=await m(e.id);let r="";o.forEach((e=>{r+=`<p>${e.date_start}/${e.date_end} by ${e.username}</p>`})),document.querySelector(".list-of-reservations").innerHTML=r}else n.innerHTML="*Date format has to be yyyy-mm-dd",t.preventDefault()}else n.innerHTML="*All fields need be populated",t.preventDefault()}));const a=await m(e.id);let s="";a.forEach((e=>{s+=`<p>${e.date_start}/${e.date_end} by ${e.username}</p>`})),document.querySelector(".list-of-reservations").innerHTML=s}))}))},p=async(e,t)=>{let n=parseInt(t.lastElementChild.textContent,10);const a=t.firstElementChild;await(async e=>await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({item_id:e})}))(parseInt(e,10))&&(n+=1,t.lastElementChild.innerText=n,a.classList.add("fa-solid"))};u().then((()=>{document.querySelectorAll(".likes").forEach((n=>{const{id:a}=n.dataset;n.addEventListener("click",(()=>{p(a,n)}),{once:!0}),e.addEventListener("click",(()=>{t.classList.toggle("show-links")}))}))})),s.addEventListener("click",(e=>{"btn comments-close-btn"!==e.target.className&&"fas fa-times"!==e.target.className||(s.style.display="none")})),i.addEventListener("click",(e=>{"btn reservation-close-btn"!==e.target.className&&"fas fa-times"!==e.target.className||i.classList.add("hide-reservation")})),(()=>{const e=(new Date).getFullYear();c.textContent=e})(),u()})();