(()=>{"use strict";const e=document.querySelector(".nav-toggle"),n=document.querySelector(".links"),t=document.querySelector(".box-container"),s=(document.querySelector(".popup-container"),document.querySelector(".shown-movies")),a=(document.querySelector("#movie-close-btn"),document.querySelector("#close-reservation"),document.querySelector(".popup-section")),i=document.querySelector(".reservation-section"),o=(document.querySelector(".btn-comments"),"https://us-central1-involvement-api.cloudfunctions.net/capstoneApi/apps/milQHnStnYxG5awlXqqf/likes/"),c=async(e,n)=>{let t=parseInt(n.lastElementChild.textContent,10);const s=n.firstElementChild;await(async e=>await fetch(o,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({item_id:e})}))(parseInt(e,10))&&(t+=1,n.lastElementChild.innerText=t,s.classList.add("fa-solid"))};(async()=>{const e=await(async e=>await fetch(`https://api.tvmaze.com/search/shows?q=${e}`).then((e=>e.json())))("s"),n=await(async()=>await fetch(`${o}`).then((e=>e.json())))(),c=new DocumentFragment,r=new DOMParser;e.forEach(((e,t)=>{const{show:s}=e,a=n.find((e=>e.item_id===s.id));let i=0;a&&(i=a.likes);const o=`\n            <div class="box" data-id=${e.show.id}>\n              <div class="box-img">\n                <img src="${s.image.original}" alt="${s.name}"/>\n              </div>\n              <div class="box-desc">\n                <h4>${s.name}</h4>\n                <div class="likes" data-id="${e.show.id}">\n                  <a href="#" class="like-btn"><i class="fa-regular fa-heart"></i></a>\n                  <p>${i}<span>likes</span></p>\n                </div>\n              </div>\n              <div class="btn-container" data-index="${t}" role="button">\n                <button class="btn btn-comments" id=${s.externals.thetvdb}>\n                  comments\n              </button>\n                <button type="button" class="btn btn-reservation" id="${e.show.externals.imdb}">Reservations</button>\n              </div>\n            </div>`,d=r.parseFromString(o,"text/html").body.firstChild;c.appendChild(d)})),t.appendChild(c);const d=(e=>{const n=document.querySelectorAll(`.${e}`);let t=0;return n.forEach((()=>{t+=1})),t})("box");s.innerText=`Shows(${d})`,document.querySelectorAll(".btn-comments").forEach((e=>{e.addEventListener("click",(async e=>{a.style.display="block";const n=await fetch(`https://api.tvmaze.com/lookup/shows?thetvdb=${e.target.id}`).then((e=>e.json())),t=`<div class="popup-container">\n      <button type="button" class="btn comments-close-btn" id="movie-close-btn">\n        <i class="fas fa-times"></i>\n      </button>\n      <div class="popup-img">\n        <img\n          src="${n.image.original}"\n          alt="${n.name}"\n        />\n      </div>\n      <div class="title-description">\n        <h3>${n.name}</h3>\n        <div class="popup-description">\n        <p>Genres: ${n.genres}</p>\n        <p>Language: ${n.language}</p>\n        <p>Premiered: ${n.premiered}</p>\n        <p>Country: ${n.network.country.name}</p>\n        </div>\n      </div>\n      <div class="popup-comments">\n        <h3>Comments(2)</h3>\n        <div class="list-of-comments">\n          <p>12/29/2022: Someone commented yesterday</p>\n          <p>12/30/2022: Someone commented today</p>\n        </div>\n      </div>\n      <form method="post" class="add-comments">\n        <h3>Add Comments</h3>\n        <div class="input-field">\n          <input\n            type="text"\n            placeholder="Your name"\n            class="input"\n            name="name"\n            id="name"\n          />\n        </div>\n        <div class="input-field">\n          <textarea\n            name="text-area"\n            id="text-area"\n            class="input"\n            cols="30"\n            rows="5"\n            placeholder="Your comments"\n          ></textarea>\n        </div>\n        <div class="btn-container">\n          <button type="submit" class="btn" id="submit">Submit</button>\n        </div>\n      </form>\n      </div>`;a.innerHTML=t}))})),document.querySelectorAll(".btn-reservation").forEach((e=>{e.addEventListener("click",(async()=>{const n=await(async e=>await fetch(`https://api.tvmaze.com/lookup/shows?imdb=${e}`).then((e=>e.json())))(e.id);i.classList.remove("hide-reservation");const t=`<div class="reservation-container">\n        <button type="button" class="btn reservation-close-btn" id="close-reservation">\n          <i class="fas fa-times"></i>\n        </button>\n        <div class="reservation-img">\n          <img\n            src="${n.image.original}"\n            alt="${n.name}"\n          />\n        </div>\n        <div class="reservation-description">\n          <h3>${n.name}</h3>\n          <div class="reservations">\n            <p>Genres: ${n.genres}</p>\n            <p>Language: ${n.language}</p>\n            <p>Premiered: ${n.premiered}</p>\n            <p>Country: ${n.network.country.name}</p>\n          </div>\n        </div>\n        <div class="popup-comments">\n          <h3>Reservations(2)</h3>\n          <div class="list-of-comments">\n            <p>01/03/2023: Someone Reserved yesterday</p>\n            <p>01/03/2023: Someone Reserved today</p>\n          </div>\n        </div>\n        <form method="post" class="add-reservation">\n          <h3>Reserve</h3>\n          <div class="input-field"><input type="text" placeholder="Your name" class="input" name="name" id="name"/>\n          </div>\n          <div class="input-field"><textarea name="text-area" id="text-area" class="input"\n              cols="30" rows="5" placeholder="Reserve"></textarea>\n          </div>\n          <div class="btn-container">\n            <button type="submit" class="btn" id="reserve">Reserve</button>\n          </div>\n        </form>\n      </div>`;i.innerHTML=t}))}))})().then((()=>{document.querySelectorAll(".like-btn").forEach((e=>{const{id:n}=e.dataset;e.addEventListener("click",(()=>{c(n,e)}),{once:!0})}))})),e.addEventListener("click",(()=>{n.classList.toggle("show-links")})),a.addEventListener("click",(e=>{"btn comments-close-btn"!==e.target.className&&"fas fa-times"!==e.target.className||(a.style.display="none")})),i.addEventListener("click",(e=>{"btn reservation-close-btn"!==e.target.className&&"fas fa-times"!==e.target.className||i.classList.add("hide-reservation")}))})();