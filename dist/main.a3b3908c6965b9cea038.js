(()=>{"use strict";const e=document.querySelector(".nav-toggle"),t=document.querySelector(".links"),n=document.querySelector(".box-container"),s=document.querySelector(".shown-movies"),a=document.querySelector("#movie-close-btn"),i=(document.querySelector("#close-reservation"),document.querySelector(".popup-section")),o=document.querySelector(".reservation-section");e.addEventListener("click",(()=>{t.classList.toggle("show-links")})),a.addEventListener("click",(()=>{i.classList.add("hide-movie")})),(async()=>{const e=await(async e=>await fetch(`https://api.tvmaze.com/search/shows?q=${e}`).then((e=>e.json())))("s"),t=new DocumentFragment,a=new DOMParser;e.forEach(((e,n)=>{const{show:s}=e,i=`\n            <div class="box" data-id=${e.show.id}>\n              <div class="box-img">\n                <img src="${s.image.original}" alt="${s.name}"/>\n              </div>\n              <div class="box-desc">\n                <h4>${s.name}</h4>\n                <div class="likes" data-id="${e.show.id}">\n                  <a href="#" class="like-btn"><i class="fa-regular fa-heart"></i></a>\n                  <small>${e.show.id} likes</small>\n                </div>\n              </div>\n              <div class="btn-container" data-index="${n}" role="button">\n                <button class="btn btn-comments" type="button" id=${s.externals.thetvdb}>\n                  comments\n              </button>\n                <button type="button" class="btn btn-reservation" id="${e.show.externals.imdb}">Reservations</button>\n              </div>\n            </div>`,o=a.parseFromString(i,"text/html").body.firstChild;t.appendChild(o)})),n.appendChild(t);const i=(e=>{const t=document.querySelectorAll(`.${e}`);let n=0;return t.forEach((()=>{n+=1})),n})("box");s.innerText=`Shows(${i})`,document.querySelectorAll(".btn-reservation").forEach((e=>{e.addEventListener("click",(async()=>{const t=await(async e=>await fetch(`https://api.tvmaze.com/lookup/shows?imdb=${e}`).then((e=>e.json())))(e.id);o.classList.remove("hide-reservation");const n=`<div class="reservation-container">\n        <button type="button" class="btn reservation-close-btn" id="close-reservation">\n          <i class="fas fa-times"></i>\n        </button>\n        <div class="reservation-img">\n          <img\n            src="${t.image.original}"\n            alt="${t.name}"\n          />\n        </div>\n        <div class="reservation-description">\n          <h3>${t.name}</h3>\n          <div class="reservations">\n            <p>Genres: ${t.genres}</p>\n            <p>Language: ${t.language}</p>\n            <p>Premiered: ${t.premiered}</p>\n            <p>Country: ${t.network.country.name}</p>\n          </div>\n        </div>\n        <div class="popup-reservations">\n          <h3>Reservations(2)</h3>\n          <div class="list-of-reservations">\n          </div>\n        </div>\n        <form method="post" class="add-reservation">\n          <h3>Add a reservation</h3>\n          <div class="input-field">\n          <input type="text" placeholder="Your name" class="input" name="name" id="nameReservation"/>\n          </div>\n          <div class="input-field">\n          <input type="text" placeholder="Start date" class="input" name="startDate" id="startDate"/>\n          </div>\n          <div class="input-field">\n          <input type="text" placeholder="End date" class="input" name="endDate" id="endDate"/>\n          </div>\n          <div class="btn-container">\n            <button type="submit" class="btn" id="reserve">Reserve</button>\n          </div>\n        </form>\n      </div>`;o.innerHTML=n,document.getElementById("reserve").addEventListener("click",(t=>{const n=document.getElementById("nameReservation").value,s=document.getElementById("startDate").value,a=document.getElementById("endDate").value;n&&s&&a?(async(e,t,n,s,a)=>{e.preventDefault(),(await fetch("https://us-central1-involvement-api.cloudfunctions.net/capstoneApi/apps/xK5LmH1OlvUhFH39ssaa/reservations/",{method:"POST",body:JSON.stringify({item_id:`"${t}"`,username:`"${n}"`,date_start:`"${s}"`,date_end:`"${a}"`}),headers:{"Content-type":"application/json; charset=UTF-8"}})).json()})(t,e.id,n,s,a):t.preventDefault()}));const s=await(async e=>await fetch(`https://us-central1-involvement-api.cloudfunctions.net/capstoneApi/apps/xK5LmH1OlvUhFH39ssaa/reservations?item_id="${e}"`).then((e=>e.json())))(e.id);let a="";s.forEach((e=>{a+=`<p>${e.date_start}-${e.date_end} by ${e.username}</p>`})),document.querySelector(".list-of-reservations").innerHTML=a}))}))})(),o.addEventListener("click",(e=>{"btn reservation-close-btn"!==e.target.className&&"fas fa-times"!==e.target.className||o.classList.add("hide-reservation")}))})();